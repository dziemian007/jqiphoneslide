/**
 * iphoneSlide - jQuery plugin
 * @version: 0.55 (2011/04/27)
 * @requires jQuery v1.4+
 * @author Hina, Cain Chen. hinablue [at] gmail [dot] com
 * Examples and documentation at: http://jquery.hinablue.me/jqiphoneslide
 * 
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 **/
(function(a){a.fn.iphoneSlide=function(f){var e={handler:null,pageHandler:null,slideHandler:null,direction:"horizontal",maxShiftPage:5,nextPageHandler:".nextPage",prevPageHandler:".prevPage",draglaunch:0.5,friction:0.325,sensitivity:20,extrashift:800,touchduring:800,easing:"swing",bounce:true,pageshowfilter:false,onShiftComplete:function(){}};var c={};var b={jqipslide2page:function(n,r){var l=a(this),m=a(this).data("workData"),g=a(this).data("options");if(m.initIphoneSlide){var n=n,i={},r=(typeof r==="boolean")?r:true,p=a(g.handler,l),q=(g.pageshowfilter?p.children(g.pageHandler).filter("visible"):p.children(g.pageHandler)),j={X:0,Y:0},k=l.width(),o=l.height(),h=q.eq(n-1);if(n<=0||n>m.totalPages){return false}l.data("workData",a.extend({},m,{nowPage:n}));var i=d.slide_to_page.call(this,n);if(r){a(p).animate(i.after,300,(a.easing[g.easing]!==undefined?g.easing:"swing"),function(){d.slide_callback.call(this)})}else{a(p).css(i.after);d.slide_callback.call(this)}}else{alert("Your target is not iPhone-Slide workspace.");return false}},jqipblank2page:function(m,n,o){var k=a(this),l=a(this).data("workData"),h=a(this).data("options"),m=a.isArray(m)?m:(typeof m==="string"?[m]:[]),n=(typeof n==="boolean")?n:false,o=(typeof n==="function")?n:(typeof o==="function")?o:function(){return false};if(l.initIphoneSlide&&m.length>0){var i=m.length,p=a(h.handler,k),j=(n)?l.totalPages+1:l.nowPage,g=(h.pageshowfilter?p.children(h.pageHandler).filter("visible").eq(0):p.children(h.pageHandler)).eq(0);a.each(m,function(q,r){g.clone().removeAttr("style").html(r).appendTo(p);if(q===i-1){k.iphoneSlide(h,o).jqipslide2page(j,false)}})}else{alert("Your target is not iPhone-Slide workspace.");return false}},init:function(g,i){var h=a.extend({},e,g),i=(typeof i==="function")?i:function(){return this};d.options=h;d.callback=i;return a(this).each(function(){var m=a(this),p=m.data("workData"),x=a(h.handler,m),k=a.extend({},{origX:0,origY:0,X:0,Y:0}),u,w,r=matrixRow=matrixColumn=0,l=1,n=__mouseStarted=__touchesDevice=false,v=(h.pageshowfilter?x.children(h.pageHandler).filter("visible"):x.children(h.pageHandler));if(m.children().length>1){alert("The Selector("+m.attr("id")+")'s page handler can not more than one element.");return this}if(h.handler===null||typeof h.handler!=="string"){h.handler=".iphone-slide-page-handler";m.children(":first").addClass("iphone-slide-page-handler")}if(a(h.handler,m).children().length==0){alert("You have no page(s) context.");return this}if(h.pageHandler===null||typeof h.pageHandler!=="string"){switch(x.attr("tagName").toLowerCase()){case"ul":case"ol":h.pageHandler="li";break;default:h.pageHandler=x.children(":first").attr("tagName").toLowerCase()}}x.unbind(".jqiphoneslide");a(h.prevPageHandler).unbind("click.jqiphoneslide",o,false);a(h.nextPageHandler).unbind("click.jqiphoneslide",t,false);var t=function(C){var z=m.data("workData"),B=parseInt(z.nowPage),A=parseInt(z.totalPages);B++;if(B<=A){__mouseStarted=true;var y=d.slide_to_page.call(m,B,0);x.animate(y.after,300,function(){__mouseStarted=false;d.slide_callback.call(this)})}else{B=A}m.data("workData",a.extend({},z,{nowPage:B}));return true};var o=function(C){var z=m.data("workData"),B=parseInt(z.nowPage),A=parseInt(z.totalPages);B--;if(B>0){__mouseStarted=true;var y=d.slide_to_page.call(m,B,0);x.animate(y.after,300,function(){__mouseStarted=false;d.slide_callback.call(this)})}else{B=1}m.data("workData",a.extend({},z,{nowPage:B}));return true};var s=function(A){if(__mouseStarted){return false}A.preventDefault();__mouseStarted=true;var z=A.originalEvent.touches||A.originalEvent.targetTouches||A.originalEvent.changedTouches,y=z===undefined?A:z[0];u=a.extend({},y,{timeStamp:A.timeStamp});if(z!==undefined){__touchesDevice=true}k.origX=a(this).position().left;k.origY=a(this).position().top;if(h.slideHandler===null||typeof h.slideHandler!=="string"){x.bind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false).bind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide",q,false)}else{x.filter(h.slideHandler).bind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false).bind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide",q,false)}};var j=function(A){if(a.browser.msie&&!A.button){return q(A)}if(__mouseStarted){A.preventDefault();var z=A.originalEvent.touches||A.originalEvent.targetTouches||A.originalEvent.changedTouches,B=z===undefined?A:z[0],y=u;w=a.extend({},B,{timeStamp:A.timeStamp});switch(h.direction){case"matrix":k.X=parseInt(B.pageX-y.pageX);k.Y=parseInt(B.pageY-y.pageY);x.css({top:(k.origY+k.Y)+"px",left:(k.origX+k.X)+"px"});break;case"vertical":k.Y=parseInt(B.pageY-y.pageY);x.css({top:(k.origY+k.Y)+"px"});break;case"horizontal":default:k.X=parseInt(B.pageX-y.pageX);x.css({left:(k.origX+k.X)+"px"})}}return !__mouseStarted};var q=function(L){L.preventDefault();if(h.slideHandler===null||typeof h.slideHandler!=="string"){x.unbind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false)}else{x.filter(h.slideHandler).unbind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false)}var G=a(this).parent().data("workData"),Q=parseInt(G.totalPages),O=parseInt(G.nowPage),A=parseInt(G.matrixRow),I=parseInt(G.matrixColumn),C,B=L.originalEvent.touches||L.originalEvent.targetTouches||L.originalEvent.changedTouches,D=u;if(B===undefined){C=__touchesDevice?w:L}else{C=B[0]===undefined?w:B[0]}if(__mouseStarted){n=(L.target==D.target)}if(Math.max(Math.abs(D.pageX-C.pageX),Math.abs(D.pageY-C.pageY))>=parseInt(h.sensitivity)){var E=Math.abs(w.timeStamp-u.timeStamp);var z={width:m.outerWidth(),height:m.outerHeight()};var y=v.eq(O-1),J={width:y.outerWidth(true),height:y.outerHeight(true)},F={X:d.get_moving_data.call(null,z.width,D.pageX,C.pageX,E),Y:d.get_moving_data.call(null,z.height,D.pageY,C.pageY,E)},M={X:0,Y:0,shift:Math.max(F.X.shift,F.Y.shift),speed:Math.max(F.X.speed,F.Y.speed)},K={X:Math.min(C.pageX-D.pageX,J.width),Y:Math.min(C.pageY-D.pageY,J.height)},H={X:(Math.abs(k.X)>=z.width*h.draglaunch||Math.abs(k.Y)>=z.height*h.draglaunch)?0:(E>h.touchduring)?1:Math.ceil(F.X.speed*F.X.shift/J.width),Y:(Math.abs(k.X)>=z.width*h.draglaunch||Math.abs(k.Y)>=z.height*h.draglaunch)?0:(E>h.touchduring)?1:Math.ceil(F.Y.speed*F.Y.shift/J.height)};during=Math.min(300,h.touchduring,Math.max(1/M.speed*Math.abs(h.extrashift),Math.abs(h.extrashift)*0.5));switch(h.direction){case"matrix":var P=Math.ceil(O/A);H.X=(H.X>A)?A:((Math.abs(k.X)>=J.width*h.draglaunch)?1:((Math.floor(Math.abs(K.Y/K.X))>2)?0:H.X));H.X=(K.X>0)?(Math.min(H.X,(O-A*(P-1)-1))):(Math.min(H.X,(A*P-O)));H.Y=(H.Y>I)?I:((Math.abs(k.Y)>=J.height*h.draglaunch)?1:((Math.floor(Math.abs(K.X/K.Y))>2)?0:H.Y));H.Y=(K.Y>0)?(Math.min(H.Y,(P-1))):(((A*H.Y+O)>Q)?(I-P):H.Y);O=(K.X>0)?(((O-H.X)<1)?1:O-H.X):((O+H.X>Q)?Q:O+H.X);O=(K.Y>0)?(((O-H.Y*A)<1)?1:O-H.Y*A):((H.Y*A>Q)?Q:O+H.Y*A);break;case"vertical":H.X=0;H.Y=(H.Y==0)?1:((H.Y>h.maxShiftPage)?h.maxShiftPage:H.Y);H.Y=(K.Y>0)?(((O-H.Y)<1)?O-1:H.Y):(((O+H.Y)>Q)?Q-O:H.Y);O=(K.Y>0)?(((O-H.Y)<1)?1:O-H.Y):(((O+H.Y)>Q)?Q:O+H.Y);break;case"horizontal":default:H.Y=0;H.X=(H.X==0)?1:((H.X>h.maxShiftPage)?h.maxShiftPage:H.X);H.X=(K.X>0)?(((O-H.X)<1)?O-1:H.X):(((O+H.X)>Q)?Q-O:H.X);O=(K.X>0)?(((O-H.X)<1)?1:O-H.X):(((O+H.X)>Q)?Q:O+H.X)}var N=(h.bounce===true)?d.slide_to_page.call(this,O,K):d.slide_to_page.call(this,O,0);if(h.bounce===true){a(this).animate(N.before,during)}a(this).animate(N.after,during,(a.easing[h.easing]!==undefined?h.easing:"swing"),function(){__mouseStarted=false;d.slide_callback.call(this)})}else{a(this).animate({top:k.origY,left:k.origX},50,function(){__mouseStarted=false})}if(h.slideHandler===null||typeof h.slideHandler!=="string"){a(this).unbind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide",q,false)}else{a(this).filter(h.slideHandler).unbind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide",q,false)}m.data("workData",a.extend({},G,{nowPage:O}));return !__mouseStarted};if(h.slideHandler===null||typeof h.slideHandler!=="string"){x.bind("mousedown.jqiphoneslide touchstart.jqiphoneslide",s,false).bind("click.jqiphoneslide",function(y){if(n){n=false;y.stopImmediatePropagation();return false}},false)}else{x.filter(h.slideHandler).bind("mousedown.jqiphoneslide touchstart.jqiphoneslide",s,false).bind("click.jqiphoneslide",function(y){if(n){n=false;y.stopImmediatePropagation();return false}},false)}a(h.nextPageHandler).bind("click.jqiphoneslide",t,false);a(h.prevPageHandler).bind("click.jqiphoneslide",o,false);d.init_pages.call(this);return this})},};var d={options:null,callback:function(){return this},get_moving_data:function(g,k,m,j){var h=0,i=0,g=g*1,k=k*1,m=m*1,j=j*1,l=d.options;h=(Math.abs(k-m)/Math.abs(j));i=Math.floor(Math.pow((h/12),2)*Math.abs(l.extrashift)/(2*(9.80665/12)*Math.abs(l.friction))*0.01);i=(k>g/2)?Math.floor(g/3):k;return{speed:h,shift:i}},init_pages:function(){var m,l=d.options,g=a(this),j=a(l.handler,g),n=(!l.pageshowfilter)?j.children(l.pageHandler):j.children(l.pageHandler).filter(":visible"),k=matrixColumn=pagesOuterWidth=pagesOuterHeight=maxWidthPage=maxHeightPage=0;m=n.length;maxWidthPage=g.width();maxHeightPage=g.height();switch(l.direction){case"matrix":k=Math.ceil(Math.sqrt(m));matrixColumn=Math.ceil(m/k);n.each(function(o,p){maxWidthPage=(a(p).outerWidth(true)>=maxWidthPage)?a(p).outerWidth(true):maxWidthPage;maxHeightPage=(a(p).outerHeight(true)>=maxHeightPage)?a(p).outerHeight(true):maxHeightPage});pagesOuterWidth=maxWidthPage*k;pagesOuterHeight=maxHeightPage*matrixColumn;j.width(pagesOuterWidth).height(pagesOuterHeight);n.each(function(o,p){if(a(p).outerWidth()<maxWidthPage){a(p).css({"margin-left":(maxWidthPage-a(p).outerWidth())/2,"margin-right":(maxWidthPage-a(p).outerWidth())/2})}if(a(p).outerHeight()<maxHeightPage){a(p).css({"margin-top":(maxHeightPage-a(p).outerHeight())/2,"margin-bottom":(maxHeightPage-a(p).outerHeight())/2})}});for(var h=matrixColumn;h>1;h--){a('<br class="matrix-break-point" style="clear:both;" />').insertAfter(n.eq((h-1)*k-1))}break;case"vertical":n.each(function(o,p){pagesOuterHeight+=a(p).outerHeight(true);maxWidthPage=(a(p).outerWidth(true)>=maxWidthPage)?a(p).outerWidth(true):maxWidthPage;maxHeightPage=(a(p).outerHeight(true)>=maxHeightPage)?a(p).outerHeight(true):maxHeightPage});n.each(function(o,p){if(a(p).outerWidth()<maxWidthPage){a(p).css("margin-left",(maxWidthPage-a(p).outerWidth())/2)}});pagesOuterWidth=maxWidthPage;j.height(pagesOuterHeight).width(pagesOuterWidth).css("top",(maxHeightPage-n.eq(0).outerHeight(true))/2);break;case"horizontal":default:n.each(function(o,p){pagesOuterWidth+=a(p).outerWidth(true);maxWidthPage=(a(p).outerWidth(true)>=maxWidthPage)?a(p).outerWidth(true):maxWidthPage;maxHeightPage=(a(p).outerHeight(true)>=maxHeightPage)?a(p).outerHeight(true):maxHeightPage});n.each(function(o,p){if(a(p).outerHeight()<maxHeightPage){a(p).css("margin-top",(maxHeightPage-a(p).outerHeight())/2)}});pagesOuterHeight=maxHeightPage;j.width(pagesOuterWidth).height(pagesOuterHeight).css("left",(maxWidthPage-n.eq(0).outerWidth(true))/2)}n.css({display:"block"});g.width(maxWidthPage).height(maxHeightPage).data("workData",a.extend({},{totalPages:m,matrixRow:k,matrixColumn:matrixColumn,pagesOuterWidth:pagesOuterWidth,pagesOuterHeight:pagesOuterHeight,nowPage:1,initIphoneSlide:true})).data("options",l);j.attr("data-target","handler");d.callback.call(this)},slide_callback:function(){var h=(a(this).attr("data-target")==="handler")?a(this).parent():a(this),g=h.data("workData"),k=g.nowPage,j=d.options||h.data("options"),i=a(j.handler,h).children(j.pageHandler);if(j.pageshowfilter){j.onShiftComplete.call(null,i.filter(":visible").eq(k-1),k)}else{j.onShiftComplete.call(null,i.eq(k-1),k)}},slide_to_page:function(n,m){var n=n,l=(a(this).attr("data-target")==="handler")?a(this).parent():a(this),g=d.options||l.data("options"),p=a(g.handler,l),m=m||{X:0,Y:0},q=(g.pageshowfilter?p.children(g.pageHandler).filter("visible"):p.children(g.pageHandler)),j={X:0,Y:0},i={before:{},after:{}},k=l.width(),o=l.height(),h=q.eq(n-1);switch(g.direction){case"matrix":j.X=h.position().left;j.X-=(k-h.outerWidth(true))/2;j.Y=h.position().top;j.Y-=(o-h.outerHeight(true))/2;i={before:{top:-1*j.Y+m.Y,left:-1*j.X+m.X},after:{top:-1*j.Y,left:-1*j.X}};break;case"vertical":j.Y=h.position().top;j.Y-=(o-h.outerHeight(true))/2;i={before:{top:-1*j.Y+m.Y},after:{top:-1*j.Y}};break;case"horizontal":default:j.X=h.position().left;j.X-=(k-h.outerWidth(true))/2;i={before:{left:-1*j.X+m.X},after:{left:-1*j.X}}}return i},};if(b[f]&&f.toLowerCase()!="init"){return b[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return b.init.apply(this,arguments)}else{a.error('Method "'+f+'" does not exist in iPhoneSlide plugin!')}}}})(jQuery);
