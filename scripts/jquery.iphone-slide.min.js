/**
 * iphoneSlide - jQuery plugin
 * @version: 0.51 (2011/03/14)
 * @requires jQuery v1.4+
 * @author Hina, Cain Chen. hinablue [at] gmail [dot] com
 * Examples and documentation at: http://jquery.hinablue.me/jqiphoneslide
 * 
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 **/
(function(a){var b={handler:null,pageHandler:null,slideHandler:null,direction:"horizontal",maxShiftPage:5,nextPageHandler:".nextPage",prevPageHandler:".prevPage",draglaunch:0.5,friction:0.325,sensitivity:20,extrashift:800,touchduring:800,easing:"swing",bounce:true,pageshowfilter:false,onShiftComplete:function(){}};a.fn.iphoneSlide=function(e,j){var c=a(this),h=a.extend({},b,e),j=(typeof j==="function")?j:function(){return false};function d(k,o,p,n){var l=0,m=0,k=k*1,o=o*1,p=p*1,n=n*1;l=(Math.abs(o-p)/Math.abs(n));m=Math.floor(Math.pow((l/12),2)*Math.abs(h.extrashift)/(2*(9.80665/12)*Math.abs(h.friction))*0.01);m=(o>k/2)?Math.floor(k/3):o;return{speed:l,shift:m}}function i(){var n,l=a(h.handler,c),o=(!h.pageshowfilter)?l.children(h.pageHandler):l.children(h.pageHandler).filter(":visible"),m=matrixColumn=pagesOuterWidth=pagesOuterHeight=maxWidthPage=maxHeightPage=0;n=o.length;maxWidthPage=c.width();maxHeightPage=c.height();switch(h.direction){case"matrix":m=Math.ceil(Math.sqrt(n));matrixColumn=Math.ceil(n/m);o.each(function(p,q){maxWidthPage=(a(q).outerWidth(true)>=maxWidthPage)?a(q).outerWidth(true):maxWidthPage;maxHeightPage=(a(q).outerHeight(true)>=maxHeightPage)?a(q).outerHeight(true):maxHeightPage});pagesOuterWidth=maxWidthPage*m;pagesOuterHeight=maxHeightPage*matrixColumn;l.width(pagesOuterWidth).height(pagesOuterHeight);o.each(function(p,q){if(a(q).outerWidth()<maxWidthPage){a(q).css({"margin-left":(maxWidthPage-a(q).outerWidth())/2,"margin-right":(maxWidthPage-a(q).outerWidth())/2})}if(a(q).outerHeight()<maxHeightPage){a(q).css({"margin-top":(maxHeightPage-a(q).outerHeight())/2,"margin-bottom":(maxHeightPage-a(q).outerHeight())/2})}});for(var k=matrixColumn;k>1;k--){a('<br class="matrix-break-point" style="clear:both;" />').insertAfter(o.eq((k-1)*m-1))}break;case"vertical":o.each(function(p,q){pagesOuterHeight+=a(q).outerHeight(true);maxWidthPage=(a(q).outerWidth(true)>=maxWidthPage)?a(q).outerWidth(true):maxWidthPage;maxHeightPage=(a(q).outerHeight(true)>=maxHeightPage)?a(q).outerHeight(true):maxHeightPage});o.each(function(p,q){if(a(q).outerWidth()<maxWidthPage){a(q).css("margin-left",(maxWidthPage-a(q).outerWidth())/2)}});pagesOuterWidth=maxWidthPage;l.height(pagesOuterHeight).width(pagesOuterWidth).css("top",(maxHeightPage-o.eq(0).outerHeight(true))/2);break;case"horizontal":default:o.each(function(p,q){pagesOuterWidth+=a(q).outerWidth(true);maxWidthPage=(a(q).outerWidth(true)>=maxWidthPage)?a(q).outerWidth(true):maxWidthPage;maxHeightPage=(a(q).outerHeight(true)>=maxHeightPage)?a(q).outerHeight(true):maxHeightPage});o.each(function(p,q){if(a(q).outerHeight()<maxHeightPage){a(q).css("margin-top",(maxHeightPage-a(q).outerHeight())/2)}});pagesOuterHeight=maxHeightPage;l.width(pagesOuterWidth).height(pagesOuterHeight).css("left",(maxWidthPage-o.eq(0).outerWidth(true))/2)}o.css({display:"block"});c.width(maxWidthPage).height(maxHeightPage).data("workData",a.extend({},{totalPages:n,matrixRow:m,matrixColumn:matrixColumn,pagesOuterWidth:pagesOuterWidth,pagesOuterHeight:pagesOuterHeight,nowPage:1,initIphoneSlide:true}));if(a.isFunction(j)){j.call(c)}}function g(){var k=c.data("workData"),l=k.nowPage;if(h.pageshowfilter){h.onShiftComplete.call(c,a(h.handler,c).children(h.pageHandler).filter(":visible").eq(l-1),l)}else{h.onShiftComplete.call(c,a(h.handler,c).children(h.pageHandler).eq(l-1),l)}}function f(p,o){var p=p,o=o||{X:0,Y:0},q=a(h.handler,c),r=(h.pageshowfilter?q.children(h.pageHandler).filter("visible"):q.children(h.pageHandler)),m={X:0,Y:0},l={before:{},after:{}},n=c.width(),s=c.height(),k=r.eq(p-1);switch(h.direction){case"matrix":m.X=k.position().left;m.X-=(n-k.outerWidth(true))/2;m.Y=k.position().top;m.Y-=(s-k.outerHeight(true))/2;l={before:{top:-1*m.Y+o.Y,left:-1*m.X+o.X},after:{top:-1*m.Y,left:-1*m.X}};break;case"vertical":m.Y=k.position().top;m.Y-=(s-k.outerHeight(true))/2;l={before:{top:-1*m.Y+o.Y},after:{top:-1*m.Y}};break;case"horizontal":default:m.X=k.position().left;m.X-=(n-k.outerWidth(true))/2;l={before:{left:-1*m.X+o.X},after:{left:-1*m.X}}}return l}return this.each(function(){var n=a(this),q=n.data("workData"),y=a(h.handler,n),l=a.extend({},{origX:0,origY:0,X:0,Y:0}),v,x,s=matrixRow=matrixColumn=0,m=1,o=__mouseStarted=__touchesDevice=false,w=a(h.handler,n).children(h.pageHandler);if(h.pageshowfilter){w=w.filter(":visible")}if(n.children().length>1){alert("The Selector("+n.attr("id")+")'s page handler can not more than one element.");return this}if(h.handler===null||typeof h.handler!=="string"){h.handler=".iphone-slide-page-handler";n.children(":first").addClass("iphone-slide-page-handler")}if(a(h.handler,n).children().length==0){alert("You have no page(s) context.");return this}if(h.pageHandler===null||typeof h.pageHandler!=="string"){switch(y.attr("tagName").toLowerCase()){case"ul":case"ol":h.pageHandler="li";break;default:h.pageHandler=y.children(":first").attr("tagName").toLowerCase()}}var u=function(C){var B=parseInt(q.nowPage),A=parseInt(q.totalPages);B++;if(B<=A){__mouseStarted=true;var z=f(B);y.animate(z.after,300,function(){__mouseStarted=false;g(n)})}else{B=A}n.data("nowPage",a.extend({},q,{nowPage:B}));return true};var p=function(C){var B=parseInt(q.nowPage),A=parseInt(q.totalPages);B--;if(B>0){__mouseStarted=true;var z=f(B);y.animate(z.after,300,function(){__mouseStarted=false;g(n)})}else{B=1}n.data("nowPage",a.extend({},q,{nowPage:B}));return true};var t=function(B){if(__mouseStarted){return false}B.preventDefault();__mouseStarted=true;var A=B.originalEvent.touches||B.originalEvent.targetTouches||B.originalEvent.changedTouches,z=A===undefined?B:A[0];v=a.extend({},z,{timeStamp:B.timeStamp});if(A!==undefined){__touchesDevice=true}l.origX=a(this).position().left;l.origY=a(this).position().top;if(h.slideHandler===null||typeof h.slideHandler!=="string"){y.bind("mousemove touchmove",k,false).bind("mouseleave mouseup touchend touchcancel",r,false)}else{y.filter(h.slideHandler).bind("mousemove touchmove",k,false).bind("mouseleave mouseup touchend touchcancel",r,false)}};var k=function(B){if(a.browser.msie&&!B.button){return r(B)}if(__mouseStarted){B.preventDefault();var A=B.originalEvent.touches||B.originalEvent.targetTouches||B.originalEvent.changedTouches,C=A===undefined?B:A[0],z=v;x=a.extend({},C,{timeStamp:B.timeStamp});switch(h.direction){case"matrix":l.X=parseInt(C.pageX-z.pageX);l.Y=parseInt(C.pageY-z.pageY);y.css({top:(l.origY+l.Y)+"px",left:(l.origX+l.X)+"px"});break;case"vertical":l.Y=parseInt(C.pageY-z.pageY);y.css({top:(l.origY+l.Y)+"px"});break;case"horizontal":default:l.X=parseInt(C.pageX-z.pageX);y.css({left:(l.origX+l.X)+"px"})}}return !__mouseStarted};var r=function(L){L.preventDefault();if(h.slideHandler===null||typeof h.slideHandler!=="string"){y.unbind("mousemove touchmove",k,false)}else{y.filter(h.slideHandler).unbind("mousemove touchmove",k,false)}var G=a(this).parent().data("workData"),Q=parseInt(G.totalPages),O=parseInt(G.nowPage),A=parseInt(G.matrixRow),I=parseInt(G.matrixColumn),C,B=L.originalEvent.touches||L.originalEvent.targetTouches||L.originalEvent.changedTouches,D=v;if(B===undefined){C=__touchesDevice?x:L}else{C=B[0]===undefined?x:B[0]}if(__mouseStarted){o=(L.target==D.target)}if(Math.max(Math.abs(D.pageX-C.pageX),Math.abs(D.pageY-C.pageY))>=parseInt(h.sensitivity)){var E=Math.abs(x.timeStamp-v.timeStamp);var z=w.eq(O-1),J={width:z.outerWidth(true),height:z.outerHeight(true)},F={X:d(J.width,D.pageX,C.pageX,E),Y:d(J.height,D.pageY,C.pageY,E)},M={X:0,Y:0,shift:Math.max(F.X.shift,F.Y.shift),speed:Math.max(F.X.speed,F.Y.speed)},K={X:Math.min(C.pageX-D.pageX,J.width),Y:Math.min(C.pageY-D.pageY,J.height)},H={X:(Math.abs(l.X)>=J.width*h.draglaunch||Math.abs(l.Y)>=J.height*h.draglaunch)?0:(E>h.touchduring)?1:Math.ceil(F.X.speed*F.X.shift/J.width),Y:(Math.abs(l.X)>=J.width*h.draglaunch||Math.abs(l.Y)>=J.height*h.draglaunch)?0:(E>h.touchduring)?1:Math.ceil(F.Y.speed*F.Y.shift/J.height)};during=Math.min(300,h.touchduring,Math.max(1/M.speed*Math.abs(h.extrashift),Math.abs(h.extrashift)*0.5));switch(h.direction){case"matrix":var P=Math.ceil(O/A);H.X=(H.X>A)?A:((Math.abs(l.X)>=J.width*h.draglaunch)?1:((Math.floor(Math.abs(K.Y/K.X))>2)?0:H.X));H.X=(K.X>0)?(Math.min(H.X,(O-A*(P-1)-1))):(Math.min(H.X,(A*P-O)));H.Y=(H.Y>I)?I:((Math.abs(l.Y)>=J.height*h.draglaunch)?1:((Math.floor(Math.abs(K.X/K.Y))>2)?0:H.Y));H.Y=(K.Y>0)?(Math.min(H.Y,(P-1))):(((A*H.Y+O)>Q)?(I-P):H.Y);O=(K.X>0)?(((O-H.X)<1)?1:O-H.X):((O+H.X>Q)?Q:O+H.X);O=(K.Y>0)?(((O-H.Y*A)<1)?1:O-H.Y*A):((H.Y*A>Q)?Q:O+H.Y*A);break;case"vertical":H.X=0;H.Y=(H.Y==0)?1:((H.Y>h.maxShiftPage)?h.maxShiftPage:H.Y);H.Y=(K.Y>0)?(((O-H.Y)<1)?O-1:H.Y):(((O+H.Y)>Q)?Q-O:H.Y);O=(K.Y>0)?(((O-H.Y)<1)?1:O-H.Y):(((O+H.Y)>Q)?Q:O+H.Y);break;case"horizontal":default:H.Y=0;H.X=(H.X==0)?1:((H.X>h.maxShiftPage)?h.maxShiftPage:H.X);H.X=(K.X>0)?(((O-H.X)<1)?O-1:H.X):(((O+H.X)>Q)?Q-O:H.X);O=(K.X>0)?(((O-H.X)<1)?1:O-H.X):(((O+H.X)>Q)?Q:O+H.X)}var N=(h.bounce===true)?f(O,K):f(O,0);if(h.bounce===true){a(this).animate(N.before,during)}a(this).animate(N.after,during,(a.easing[h.easing]!==undefined?h.easing:"swing"),function(){__mouseStarted=false;g()})}else{a(this).animate({top:l.origY,left:l.origX},50,function(){__mouseStarted=false})}if(h.slideHandler===null||typeof h.slideHandler!=="string"){a(this).unbind("mouseleave mouseup touchend",r,false)}else{a(this).filter(h.slideHandler).unbind("mouseleave mouseup touchend",r,false)}n.data("workData",a.extend({},G,{nowPage:O}));return !__mouseStarted};if(h.slideHandler===null||typeof h.slideHandler!=="string"){y.bind("mousedown touchstart",t,false).bind("click",function(z){if(o){o=false;z.stopImmediatePropagation();return false}},false)}else{y.filter(h.slideHandler).bind("mousedown touchstart",t,false).bind("click",function(z){if(o){o=false;z.stopImmediatePropagation();return false}},false)}i();return this})};a.fn.slidingToPage=function(d){var c=a(this).data("workData");if(c.initIphoneSlide){}else{alert("Your target is not iPhone-Slide workspace.");return false}}})(jQuery);
