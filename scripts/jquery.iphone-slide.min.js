/**
 * iphoneSlide - jQuery plugin
 * @version: 0.53 (2011/04/25)
 * @requires jQuery v1.4+
 * @author Hina, Cain Chen. hinablue [at] gmail [dot] com
 * Examples and documentation at: http://jquery.hinablue.me/jqiphoneslide
 * 
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 **/
(function(a){var b={handler:null,pageHandler:null,slideHandler:null,direction:"horizontal",maxShiftPage:5,nextPageHandler:".nextPage",prevPageHandler:".prevPage",draglaunch:0.5,friction:0.325,sensitivity:20,extrashift:800,touchduring:800,easing:"swing",bounce:true,pageshowfilter:false,onShiftComplete:function(){}};a.fn.iphoneSlide=function(d,i){var g=a.extend({},b,d),i=(typeof i==="function")?i:function(){return false};var c=function(j,n,o,m){var k=0,l=0,j=j*1,n=n*1,o=o*1,m=m*1;k=(Math.abs(n-o)/Math.abs(m));l=Math.floor(Math.pow((k/12),2)*Math.abs(g.extrashift)/(2*(9.80665/12)*Math.abs(g.friction))*0.01);l=(n>j/2)?Math.floor(j/3):n;return{speed:k,shift:l}};var h=function(j){var n,l=a(g.handler,j),o=(!g.pageshowfilter)?l.children(g.pageHandler):l.children(g.pageHandler).filter(":visible"),m=matrixColumn=pagesOuterWidth=pagesOuterHeight=maxWidthPage=maxHeightPage=0;n=o.length;maxWidthPage=j.width();maxHeightPage=j.height();switch(g.direction){case"matrix":m=Math.ceil(Math.sqrt(n));matrixColumn=Math.ceil(n/m);o.each(function(p,q){maxWidthPage=(a(q).outerWidth(true)>=maxWidthPage)?a(q).outerWidth(true):maxWidthPage;maxHeightPage=(a(q).outerHeight(true)>=maxHeightPage)?a(q).outerHeight(true):maxHeightPage});pagesOuterWidth=maxWidthPage*m;pagesOuterHeight=maxHeightPage*matrixColumn;l.width(pagesOuterWidth).height(pagesOuterHeight);o.each(function(p,q){if(a(q).outerWidth()<maxWidthPage){a(q).css({"margin-left":(maxWidthPage-a(q).outerWidth())/2,"margin-right":(maxWidthPage-a(q).outerWidth())/2})}if(a(q).outerHeight()<maxHeightPage){a(q).css({"margin-top":(maxHeightPage-a(q).outerHeight())/2,"margin-bottom":(maxHeightPage-a(q).outerHeight())/2})}});for(var k=matrixColumn;k>1;k--){a('<br class="matrix-break-point" style="clear:both;" />').insertAfter(o.eq((k-1)*m-1))}break;case"vertical":o.each(function(p,q){pagesOuterHeight+=a(q).outerHeight(true);maxWidthPage=(a(q).outerWidth(true)>=maxWidthPage)?a(q).outerWidth(true):maxWidthPage;maxHeightPage=(a(q).outerHeight(true)>=maxHeightPage)?a(q).outerHeight(true):maxHeightPage});o.each(function(p,q){if(a(q).outerWidth()<maxWidthPage){a(q).css("margin-left",(maxWidthPage-a(q).outerWidth())/2)}});pagesOuterWidth=maxWidthPage;l.height(pagesOuterHeight).width(pagesOuterWidth).css("top",(maxHeightPage-o.eq(0).outerHeight(true))/2);break;case"horizontal":default:o.each(function(p,q){pagesOuterWidth+=a(q).outerWidth(true);maxWidthPage=(a(q).outerWidth(true)>=maxWidthPage)?a(q).outerWidth(true):maxWidthPage;maxHeightPage=(a(q).outerHeight(true)>=maxHeightPage)?a(q).outerHeight(true):maxHeightPage});o.each(function(p,q){if(a(q).outerHeight()<maxHeightPage){a(q).css("margin-top",(maxHeightPage-a(q).outerHeight())/2)}});pagesOuterHeight=maxHeightPage;l.width(pagesOuterWidth).height(pagesOuterHeight).css("left",(maxWidthPage-o.eq(0).outerWidth(true))/2)}o.css({display:"block"});j.width(maxWidthPage).height(maxHeightPage).data("workData",a.extend({},{totalPages:n,matrixRow:m,matrixColumn:matrixColumn,pagesOuterWidth:pagesOuterWidth,pagesOuterHeight:pagesOuterHeight,nowPage:1,initIphoneSlide:true}));j.data("options",g);if(a.isFunction(i)){i.call(j)}};var f=function(k){var j=k.data("workData"),l=j.nowPage;if(g.pageshowfilter){g.onShiftComplete.call(k,a(g.handler,k).children(g.pageHandler).filter(":visible").eq(l-1),l)}else{g.onShiftComplete.call(k,a(g.handler,k).children(g.pageHandler).eq(l-1),l)}};var e=function(p,o,n){var p=p,o=o||{X:0,Y:0},r=a(g.handler,n),s=(g.pageshowfilter?r.children(g.pageHandler).filter("visible"):r.children(g.pageHandler)),l={X:0,Y:0},k={before:{},after:{}},m=n.width(),q=n.height(),j=s.eq(p-1);switch(g.direction){case"matrix":l.X=j.position().left;l.X-=(m-j.outerWidth(true))/2;l.Y=j.position().top;l.Y-=(q-j.outerHeight(true))/2;k={before:{top:-1*l.Y+o.Y,left:-1*l.X+o.X},after:{top:-1*l.Y,left:-1*l.X}};break;case"vertical":l.Y=j.position().top;l.Y-=(q-j.outerHeight(true))/2;k={before:{top:-1*l.Y+o.Y},after:{top:-1*l.Y}};break;case"horizontal":default:l.X=j.position().left;l.X-=(m-j.outerWidth(true))/2;k={before:{left:-1*l.X+o.X},after:{left:-1*l.X}}}return k};return a(this).each(function(){var m=a(this),p=m.data("workData"),x=a(g.handler,m),k=a.extend({},{origX:0,origY:0,X:0,Y:0}),u,w,r=matrixRow=matrixColumn=0,l=1,n=__mouseStarted=__touchesDevice=false,v=(g.pageshowfilter?x.children(g.pageHandler).filter("visible"):x.children(g.pageHandler));if(m.children().length>1){alert("The Selector("+m.attr("id")+")'s page handler can not more than one element.");return this}if(g.handler===null||typeof g.handler!=="string"){g.handler=".iphone-slide-page-handler";m.children(":first").addClass("iphone-slide-page-handler")}if(a(g.handler,m).children().length==0){alert("You have no page(s) context.");return this}if(g.pageHandler===null||typeof g.pageHandler!=="string"){switch(x.attr("tagName").toLowerCase()){case"ul":case"ol":g.pageHandler="li";break;default:g.pageHandler=x.children(":first").attr("tagName").toLowerCase()}}x.unbind(".jqiphoneslide");a(g.prevPageHandler).unbind("click.jqiphoneslide",o,false);a(g.nextPageHandler).unbind("click.jqiphoneslide",t,false);var t=function(C){var z=m.data("workData"),B=parseInt(z.nowPage),A=parseInt(z.totalPages);B++;if(B<=A){__mouseStarted=true;var y=e(B,0,m);x.animate(y.after,300,function(){__mouseStarted=false;f(m)})}else{B=A}m.data("workData",a.extend({},z,{nowPage:B}));return true};var o=function(C){var z=m.data("workData"),B=parseInt(z.nowPage),A=parseInt(z.totalPages);B--;if(B>0){__mouseStarted=true;var y=e(B,0,m);x.animate(y.after,300,function(){__mouseStarted=false;f(m)})}else{B=1}m.data("workData",a.extend({},z,{nowPage:B}));return true};var s=function(A){if(__mouseStarted){return false}A.preventDefault();__mouseStarted=true;var z=A.originalEvent.touches||A.originalEvent.targetTouches||A.originalEvent.changedTouches,y=z===undefined?A:z[0];u=a.extend({},y,{timeStamp:A.timeStamp});if(z!==undefined){__touchesDevice=true}k.origX=a(this).position().left;k.origY=a(this).position().top;if(g.slideHandler===null||typeof g.slideHandler!=="string"){x.bind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false).bind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide",q,false)}else{x.filter(g.slideHandler).bind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false).bind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide",q,false)}};var j=function(A){if(a.browser.msie&&!A.button){return q(A)}if(__mouseStarted){A.preventDefault();var z=A.originalEvent.touches||A.originalEvent.targetTouches||A.originalEvent.changedTouches,B=z===undefined?A:z[0],y=u;w=a.extend({},B,{timeStamp:A.timeStamp});switch(g.direction){case"matrix":k.X=parseInt(B.pageX-y.pageX);k.Y=parseInt(B.pageY-y.pageY);x.css({top:(k.origY+k.Y)+"px",left:(k.origX+k.X)+"px"});break;case"vertical":k.Y=parseInt(B.pageY-y.pageY);x.css({top:(k.origY+k.Y)+"px"});break;case"horizontal":default:k.X=parseInt(B.pageX-y.pageX);x.css({left:(k.origX+k.X)+"px"})}}return !__mouseStarted};var q=function(L){L.preventDefault();if(g.slideHandler===null||typeof g.slideHandler!=="string"){x.unbind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false)}else{x.filter(g.slideHandler).unbind("mousemove.jqiphoneslide touchmove.jqiphoneslide",j,false)}var G=a(this).parent().data("workData"),Q=parseInt(G.totalPages),O=parseInt(G.nowPage),A=parseInt(G.matrixRow),I=parseInt(G.matrixColumn),C,B=L.originalEvent.touches||L.originalEvent.targetTouches||L.originalEvent.changedTouches,D=u;if(B===undefined){C=__touchesDevice?w:L}else{C=B[0]===undefined?w:B[0]}if(__mouseStarted){n=(L.target==D.target)}if(Math.max(Math.abs(D.pageX-C.pageX),Math.abs(D.pageY-C.pageY))>=parseInt(g.sensitivity)){var E=Math.abs(w.timeStamp-u.timeStamp);var z={width:m.outerWidth(),height:m.outerHeight()};var y=v.eq(O-1),J={width:y.outerWidth(true),height:y.outerHeight(true)},F={X:c(z.width,D.pageX,C.pageX,E),Y:c(z.height,D.pageY,C.pageY,E)},M={X:0,Y:0,shift:Math.max(F.X.shift,F.Y.shift),speed:Math.max(F.X.speed,F.Y.speed)},K={X:Math.min(C.pageX-D.pageX,J.width),Y:Math.min(C.pageY-D.pageY,J.height)},H={X:(Math.abs(k.X)>=z.width*g.draglaunch||Math.abs(k.Y)>=z.height*g.draglaunch)?0:(E>g.touchduring)?1:Math.ceil(F.X.speed*F.X.shift/J.width),Y:(Math.abs(k.X)>=z.width*g.draglaunch||Math.abs(k.Y)>=z.height*g.draglaunch)?0:(E>g.touchduring)?1:Math.ceil(F.Y.speed*F.Y.shift/J.height)};during=Math.min(300,g.touchduring,Math.max(1/M.speed*Math.abs(g.extrashift),Math.abs(g.extrashift)*0.5));switch(g.direction){case"matrix":var P=Math.ceil(O/A);H.X=(H.X>A)?A:((Math.abs(k.X)>=J.width*g.draglaunch)?1:((Math.floor(Math.abs(K.Y/K.X))>2)?0:H.X));H.X=(K.X>0)?(Math.min(H.X,(O-A*(P-1)-1))):(Math.min(H.X,(A*P-O)));H.Y=(H.Y>I)?I:((Math.abs(k.Y)>=J.height*g.draglaunch)?1:((Math.floor(Math.abs(K.X/K.Y))>2)?0:H.Y));H.Y=(K.Y>0)?(Math.min(H.Y,(P-1))):(((A*H.Y+O)>Q)?(I-P):H.Y);O=(K.X>0)?(((O-H.X)<1)?1:O-H.X):((O+H.X>Q)?Q:O+H.X);O=(K.Y>0)?(((O-H.Y*A)<1)?1:O-H.Y*A):((H.Y*A>Q)?Q:O+H.Y*A);break;case"vertical":H.X=0;H.Y=(H.Y==0)?1:((H.Y>g.maxShiftPage)?g.maxShiftPage:H.Y);H.Y=(K.Y>0)?(((O-H.Y)<1)?O-1:H.Y):(((O+H.Y)>Q)?Q-O:H.Y);O=(K.Y>0)?(((O-H.Y)<1)?1:O-H.Y):(((O+H.Y)>Q)?Q:O+H.Y);break;case"horizontal":default:H.Y=0;H.X=(H.X==0)?1:((H.X>g.maxShiftPage)?g.maxShiftPage:H.X);H.X=(K.X>0)?(((O-H.X)<1)?O-1:H.X):(((O+H.X)>Q)?Q-O:H.X);O=(K.X>0)?(((O-H.X)<1)?1:O-H.X):(((O+H.X)>Q)?Q:O+H.X)}var N=(g.bounce===true)?e(O,K,m):e(O,0,m);if(g.bounce===true){a(this).animate(N.before,during)}a(this).animate(N.after,during,(a.easing[g.easing]!==undefined?g.easing:"swing"),function(){__mouseStarted=false;f(m)})}else{a(this).animate({top:k.origY,left:k.origX},50,function(){__mouseStarted=false})}if(g.slideHandler===null||typeof g.slideHandler!=="string"){a(this).unbind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide",q,false)}else{a(this).filter(g.slideHandler).unbind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide",q,false)}m.data("workData",a.extend({},G,{nowPage:O}));return !__mouseStarted};if(g.slideHandler===null||typeof g.slideHandler!=="string"){x.bind("mousedown.jqiphoneslide touchstart.jqiphoneslide",s,false).bind("click.jqiphoneslide",function(y){if(n){n=false;y.stopImmediatePropagation();return false}},false)}else{x.filter(g.slideHandler).bind("mousedown.jqiphoneslide touchstart.jqiphoneslide",s,false).bind("click.jqiphoneslide",function(y){if(n){n=false;y.stopImmediatePropagation();return false}},false)}a(g.nextPageHandler).bind("click.jqiphoneslide",t,false);a(g.prevPageHandler).bind("click.jqiphoneslide",o,false);h(m);return this})};a.fn.jqipblank2page=function(i,j,k){var g=a(this),h=a(this).data("workData"),d=a(this).data("options"),i=a.isArray(i)?i:(typeof i==="string"?[i]:[]),j=(typeof j==="boolean")?j:false,k=(typeof j==="function")?j:(typeof k==="function")?k:function(){return false};if(h.initIphoneSlide&&i.length>0){var e=i.length,l=a(d.handler,g),f=(j)?h.totalPages+1:h.nowPage,c=(d.pageshowfilter?l.children(d.pageHandler).filter("visible").eq(0):l.children(d.pageHandler)).eq(0);a.each(i,function(m,n){c.clone().removeAttr("style").html(n).appendTo(l);if(m===e-1){g.iphoneSlide(d,k).jqipslide2page(f,false)}})}else{alert("Your target is not iPhone-Slide workspace.");return false}};a.fn.jqipslide2page=function(j,n){var h=a(this),i=a(this).data("workData"),c=a(this).data("options");if(i.initIphoneSlide){var j=j,e={},n=(typeof n==="boolean")?n:true,l=a(c.handler,h),m=(c.pageshowfilter?l.children(c.pageHandler).filter("visible"):l.children(c.pageHandler)),f={X:0,Y:0},g=h.width(),k=h.height(),d=m.eq(j-1);if(j<=0||j>i.totalPages){return false}h.data("workData",a.extend({},i,{nowPage:j}));switch(c.direction){case"matrix":f.X=d.position().left;f.X-=(g-d.outerWidth(true))/2;f.Y=d.position().top;f.Y-=(k-d.outerHeight(true))/2;e={top:-1*f.Y,left:-1*f.X};break;case"vertical":f.Y=d.position().top;f.Y-=(k-d.outerHeight(true))/2;e={top:-1*f.Y};break;case"horizontal":default:f.X=d.position().left;f.X-=(g-d.outerWidth(true))/2;e={left:-1*f.X}}if(n){a(l).animate(e,300,(a.easing[c.easing]!==undefined?c.easing:"swing"),function(){if(c.pageshowfilter){c.onShiftComplete.call(h,a(c.handler,h).children(c.pageHandler).filter(":visible").eq(j-1),j)}else{c.onShiftComplete.call(h,a(c.handler,h).children(c.pageHandler).eq(j-1),j)}})}else{a(l).css(e);if(c.pageshowfilter){c.onShiftComplete.call(h,a(c.handler,h).children(c.pageHandler).filter(":visible").eq(j-1),j)}else{c.onShiftComplete.call(h,a(c.handler,h).children(c.pageHandler).eq(j-1),j)}}}else{alert("Your target is not iPhone-Slide workspace.");return false}}})(jQuery);
