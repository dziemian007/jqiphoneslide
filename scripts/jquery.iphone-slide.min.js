/**
 * iphoneSlide - jQuery plugin
 * @version: 0.56 (2011/07/07)
 * @requires jQuery v1.4+
 * @author Hina, Cain Chen. hinablue [at] gmail [dot] com
 * Examples and documentation at: http://jquery.hinablue.me/jqiphoneslide
 * 
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 **/(function(a){a.fn.iphoneSlide=function(b){var c={handler:null,pageHandler:null,slideHandler:null,direction:"horizontal",maxShiftPage:5,nextPageHandler:".nextPage",prevPageHandler:".prevPage",draglaunch:.5,friction:.325,sensitivity:20,extrashift:800,touchduring:800,easing:"swing",bounce:!0,pageshowfilter:!1,onShiftComplete:function(){}},d={},e={jqipslide2page:function(b,c){var d=a(this),e=a(this).data("workData"),g=a(this).data("options");if(!e.initIphoneSlide){alert("Your target is not iPhone-Slide workspace.");return!1}var b=b,h={},c=typeof c=="boolean"?c:!0,i=a(g.handler,d),j=g.pageshowfilter?i.children(g.pageHandler).filter("visible"):i.children(g.pageHandler),k={X:0,Y:0},l=d.width(),m=d.height(),n=j.eq(b-1);if(b<=0||b>e.totalPages)return!1;d.data("workData",a.extend({},e,{nowPage:b}));var h=f.slide_to_page.call(this,b);c?a(i).animate(h.after,300,a.easing[g.easing]!==undefined?g.easing:"swing",function(){f.slide_callback.call(this)}):(a(i).css(h.after),f.slide_callback.call(this))},jqipblank2page:function(b,c,d){var e=a(this),f=a(this).data("workData"),g=a(this).data("options"),b=a.isArray(b)?b:typeof b=="string"?[b]:[],c=typeof c=="boolean"?c:!1,d=typeof c=="function"?c:typeof d=="function"?d:function(){return!1};if(!(f.initIphoneSlide&&b.length>0)){alert("Your target is not iPhone-Slide workspace.");return!1}var h=b.length,i=a(g.handler,e),j=c?f.totalPages+1:f.nowPage,k=(g.pageshowfilter?i.children(g.pageHandler).filter("visible").eq(0):i.children(g.pageHandler)).eq(0);a.each(b,function(a,b){k.clone().removeAttr("style").html(b).appendTo(i),a===h-1&&e.iphoneSlide(g,d).jqipslide2page(j,!1)})},init:function(b,d){var e=a.extend({},c,b),d=typeof d=="function"?d:function(){return this};f.options=e,f.callback=d;return a(this).each(function(){var b=a(this),c=b.data("workData"),d=a(e.handler,b),g=a.extend({},{origX:0,origY:0,X:0,Y:0}),h,i,j=matrixRow=matrixColumn=0,k=1,l=__mouseStarted=__touchesDevice=!1,m=e.pageshowfilter?d.children(e.pageHandler).filter("visible"):d.children(e.pageHandler);if(b.children().length>1){alert("The Selector("+b.attr("id")+")'s page handler can not more than one element.");return this}if(e.handler===null||typeof e.handler!="string")e.handler=".iphone-slide-page-handler",b.children(":first").addClass("iphone-slide-page-handler");if(a(e.handler,b).children().length==0){alert("You have no page(s) context.");return this}if(e.pageHandler===null||typeof e.pageHandler!="string")switch(d.attr("tagName").toLowerCase()){case"ul":case"ol":e.pageHandler="li";break;default:e.pageHandler=d.children(":first").attr("tagName").toLowerCase()}d.unbind(".jqiphoneslide"),a(e.prevPageHandler).unbind("click.jqiphoneslide",o,!1),a(e.nextPageHandler).unbind("click.jqiphoneslide",n,!1);var n=function(c){var g=b.data("workData"),h=parseInt(g.nowPage),i=parseInt(g.totalPages);h++;if(h<=i){__mouseStarted=!0;var j=f.slide_to_page.call(b,h,0);d.animate(j.after,300,e.bounce&&a.easing[e.easing]!==undefined?e.easing:"swing",function(){__mouseStarted=!1,f.slide_callback.call(this)})}else h=i;b.data("workData",a.extend({},g,{nowPage:h}));return!0},o=function(c){var g=b.data("workData"),h=parseInt(g.nowPage),i=parseInt(g.totalPages);h--;if(h>0){__mouseStarted=!0;var j=f.slide_to_page.call(b,h,0);d.animate(j.after,300,e.bounce&&a.easing[e.easing]!==undefined?e.easing:"swing",function(){__mouseStarted=!1,f.slide_callback.call(this)})}else h=1;b.data("workData",a.extend({},g,{nowPage:h}));return!0},p=function(b){if(__mouseStarted)return!1;b.preventDefault(),__mouseStarted=!0;var c=b.originalEvent.touches||b.originalEvent.targetTouches||b.originalEvent.changedTouches,f=c===undefined?b:c[0];h=a.extend({},f,{timeStamp:b.timeStamp}),c!==undefined&&(__touchesDevice=!0),g.origX=a(this).position().left,g.origY=a(this).position().top,e.slideHandler===null||typeof e.slideHandler!="string"?d.bind("mousemove.jqiphoneslide touchmove.jqiphoneslide",q,!1).bind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide",r,!1):d.filter(e.slideHandler).bind("mousemove.jqiphoneslide touchmove.jqiphoneslide",q,!1).bind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide touchcancel.jqiphoneslide",r,!1)},q=function(b){if(a.browser.msie&&!b.button)return r(b);if(__mouseStarted){b.preventDefault();var c=b.originalEvent.touches||b.originalEvent.targetTouches||b.originalEvent.changedTouches,f=c===undefined?b:c[0],j=h;i=a.extend({},f,{timeStamp:b.timeStamp});switch(e.direction){case"matrix":g.X=parseInt(f.pageX-j.pageX),g.Y=parseInt(f.pageY-j.pageY),d.css({top:g.origY+g.Y+"px",left:g.origX+g.X+"px"});break;case"vertical":g.Y=parseInt(f.pageY-j.pageY),d.css({top:g.origY+g.Y+"px"});break;case"horizontal":default:g.X=parseInt(f.pageX-j.pageX),d.css({left:g.origX+g.X+"px"})}}return!__mouseStarted},r=function(c){c.preventDefault(),e.slideHandler===null||typeof e.slideHandler!="string"?d.unbind("mousemove.jqiphoneslide touchmove.jqiphoneslide",q,!1):d.filter(e.slideHandler).unbind("mousemove.jqiphoneslide touchmove.jqiphoneslide",q,!1);var j=a(this).parent().data("workData"),k=parseInt(j.totalPages),n=parseInt(j.nowPage),o=parseInt(j.matrixRow),p=parseInt(j.matrixColumn),s,t=c.originalEvent.touches||c.originalEvent.targetTouches||c.originalEvent.changedTouches,u=h;t===undefined?s=__touchesDevice?i:c:s=t[0]===undefined?i:t[0],__mouseStarted&&(l=c.target==u.target);if(Math.max(Math.abs(u.pageX-s.pageX),Math.abs(u.pageY-s.pageY))>=parseInt(e.sensitivity)){l=!1;var v=Math.abs(i.timeStamp-h.timeStamp),w={width:b.outerWidth(),height:b.outerHeight()},x=m.eq(n-1),y={width:x.outerWidth(!0),height:x.outerHeight(!0)},z={X:f.get_moving_data.call(null,w.width,u.pageX,s.pageX,v),Y:f.get_moving_data.call(null,w.height,u.pageY,s.pageY,v)},A={X:0,Y:0,shift:Math.max(z.X.shift,z.Y.shift),speed:Math.max(z.X.speed,z.Y.speed)},B={X:Math.min(s.pageX-u.pageX,y.width),Y:Math.min(s.pageY-u.pageY,y.height)},C={X:Math.abs(g.X)>=w.width*e.draglaunch||Math.abs(g.Y)>=w.height*e.draglaunch?0:v>e.touchduring?1:Math.ceil(z.X.speed*z.X.shift/y.width),Y:Math.abs(g.X)>=w.width*e.draglaunch||Math.abs(g.Y)>=w.height*e.draglaunch?0:v>e.touchduring?1:Math.ceil(z.Y.speed*z.Y.shift/y.height)};during=Math.min(300,e.touchduring,Math.max(1/A.speed*Math.abs(e.extrashift),Math.abs(e.extrashift)*.5));switch(e.direction){case"matrix":var D=Math.ceil(n/o);C.X=C.X>o?o:Math.abs(g.X)>=y.width*e.draglaunch?1:Math.floor(Math.abs(B.Y/B.X))>2?0:C.X,C.X=B.X>0?Math.min(C.X,n-o*(D-1)-1):Math.min(C.X,o*D-n),C.Y=C.Y>p?p:Math.abs(g.Y)>=y.height*e.draglaunch?1:Math.floor(Math.abs(B.X/B.Y))>2?0:C.Y,C.Y=B.Y>0?Math.min(C.Y,D-1):o*C.Y+n>k?p-D:C.Y,n=B.X>0?n-C.X<1?1:n-C.X:n+C.X>k?k:n+C.X,n=B.Y>0?n-C.Y*o<1?1:n-C.Y*o:C.Y*o>k?k:n+C.Y*o;break;case"vertical":C.X=0,C.Y=C.Y==0?1:C.Y>e.maxShiftPage?e.maxShiftPage:C.Y,C.Y=B.Y>0?n-C.Y<1?n-1:C.Y:n+C.Y>k?k-n:C.Y,n=B.Y>0?n-C.Y<1?1:n-C.Y:n+C.Y>k?k:n+C.Y;break;case"horizontal":default:C.Y=0,C.X=C.X==0?1:C.X>e.maxShiftPage?e.maxShiftPage:C.X,C.X=B.X>0?n-C.X<1?n-1:C.X:n+C.X>k?k-n:C.X,n=B.X>0?n-C.X<1?1:n-C.X:n+C.X>k?k:n+C.X}var E=e.bounce===!0?f.slide_to_page.call(this,n,B):f.slide_to_page.call(this,n,0);e.bounce===!0&&a(this).animate(E.before,during),a(this).animate(E.after,during,a.easing[e.easing]!==undefined?e.easing:"swing",function(){__mouseStarted=!1,f.slide_callback.call(this)})}else a(this).animate({top:g.origY,left:g.origX},50,function(){__mouseStarted=!1});e.slideHandler===null||typeof e.slideHandler!="string"?a(this).unbind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide",r,!1):a(this).filter(e.slideHandler).unbind("mouseleave.jqiphoneslide mouseup.jqiphoneslide touchend.jqiphoneslide",r,!1),b.data("workData",a.extend({},j,{nowPage:n}));return!__mouseStarted},s=function(a){if(l){l=!1,a.stopImmediatePropagation();return!0}return!1};e.slideHandler===null||typeof e.slideHandler!="string"?d.bind("mousedown.jqiphoneslide touchstart.jqiphoneslide",p,!1).bind("click.jqiphoneslide",s,!1):d.filter(e.slideHandler).bind("mousedown.jqiphoneslide touchstart.jqiphoneslide",p,!1).bind("click.jqiphoneslide",s,!1),a(e.nextPageHandler).bind("click.jqiphoneslide",n,!1),a(e.prevPageHandler).bind("click.jqiphoneslide",o,!1),f.init_pages.call(this);return this})}},f={options:null,callback:function(){return this},get_moving_data:function(a,b,c,d){var e=0,g=0,a=a*1,b=b*1,c=c*1,d=d*1,h=f.options;e=Math.abs(b-c)/Math.abs(d),g=Math.floor(Math.pow(e/12,2)*Math.abs(h.extrashift)/(2*(9.80665/12)*Math.abs(h.friction))*.01),g=b>a/2?Math.floor(a/3):b;return{speed:e,shift:g}},init_pages:function(){var b,c=f.options,d=a(this),e=a(c.handler,d),g=c.pageshowfilter?e.children(c.pageHandler).filter(":visible"):e.children(c.pageHandler),h=matrixColumn=pagesOuterWidth=pagesOuterHeight=maxWidthPage=maxHeightPage=0;b=g.length,maxWidthPage=d.width(),maxHeightPage=d.height();switch(c.direction){case"matrix":h=Math.ceil(Math.sqrt(b)),matrixColumn=Math.ceil(b/h),g.each(function(b,c){maxWidthPage=a(c).outerWidth(!0)>=maxWidthPage?a(c).outerWidth(!0):maxWidthPage,maxHeightPage=a(c).outerHeight(!0)>=maxHeightPage?a(c).outerHeight(!0):maxHeightPage}),pagesOuterWidth=maxWidthPage*h,pagesOuterHeight=maxHeightPage*matrixColumn,e.width(pagesOuterWidth).height(pagesOuterHeight),g.each(function(b,c){a(c).outerWidth()<maxWidthPage&&a(c).css({"margin-left":(maxWidthPage-a(c).outerWidth())/2,"margin-right":(maxWidthPage-a(c).outerWidth())/2}),a(c).outerHeight()<maxHeightPage&&a(c).css({"margin-top":(maxHeightPage-a(c).outerHeight())/2,"margin-bottom":(maxHeightPage-a(c).outerHeight())/2})});for(var i=matrixColumn;i>1;i--)a('<br class="matrix-break-point" style="clear:both;" />').insertAfter(g.eq((i-1)*h-1));break;case"vertical":g.each(function(b,c){pagesOuterHeight+=a(c).outerHeight(!0),maxWidthPage=a(c).outerWidth(!0)>=maxWidthPage?a(c).outerWidth(!0):maxWidthPage,maxHeightPage=a(c).outerHeight(!0)>=maxHeightPage?a(c).outerHeight(!0):maxHeightPage}),g.each(function(b,c){a(c).outerWidth()<maxWidthPage&&a(c).css("margin-left",(maxWidthPage-a(c).outerWidth())/2)}),pagesOuterWidth=maxWidthPage,e.height(pagesOuterHeight).width(pagesOuterWidth).css("top",(maxHeightPage-g.eq(0).outerHeight(!0))/2);break;case"horizontal":default:g.each(function(b,c){pagesOuterWidth+=a(c).outerWidth(!0),maxWidthPage=a(c).outerWidth(!0)>=maxWidthPage?a(c).outerWidth(!0):maxWidthPage,maxHeightPage=a(c).outerHeight(!0)>=maxHeightPage?a(c).outerHeight(!0):maxHeightPage}),g.each(function(b,c){a(c).outerHeight()<maxHeightPage&&a(c).css("margin-top",(maxHeightPage-a(c).outerHeight())/2)}),pagesOuterHeight=maxHeightPage,e.width(pagesOuterWidth).height(pagesOuterHeight).css("left",(maxWidthPage-g.eq(0).outerWidth(!0))/2)}g.css({display:"block"}),d.width(maxWidthPage).height(maxHeightPage).data("workData",a.extend({},{totalPages:b,matrixRow:h,matrixColumn:matrixColumn,pagesOuterWidth:pagesOuterWidth,pagesOuterHeight:pagesOuterHeight,nowPage:1,initIphoneSlide:!0})).data("options",c),e.attr("data-target","handler"),f.callback.call(this)},slide_callback:function(){var b=a(this).attr("data-target")==="handler"?a(this).parent():a(this),c=b.data("workData"),d=c.nowPage,e=f.options||b.data("options"),g=a(e.handler,b).children(e.pageHandler);e.pageshowfilter?e.onShiftComplete.call(null,g.filter(":visible").eq(d-1),d):e.onShiftComplete.call(null,g.eq(d-1),d)},slide_to_page:function(b,c){var b=b,d=a(this).attr("data-target")==="handler"?a(this).parent():a(this),e=f.options||d.data("options"),g=a(e.handler,d),c=c||{X:0,Y:0},h=e.pageshowfilter?g.children(e.pageHandler).filter("visible"):g.children(e.pageHandler),i={X:0,Y:0},j={before:{},after:{}},k=d.width(),l=d.height(),m=h.eq(b-1);switch(e.direction){case"matrix":i.X=m.position().left,i.X-=(k-m.outerWidth(!0))/2,i.Y=m.position().top,i.Y-=(l-m.outerHeight(!0))/2,j={before:{top:-1*i.Y+c.Y,left:-1*i.X+c.X},after:{top:-1*i.Y,left:-1*i.X}};break;case"vertical":i.Y=m.position().top,i.Y-=(l-m.outerHeight(!0))/2,j={before:{top:-1*i.Y+c.Y},after:{top:-1*i.Y}};break;case"horizontal":default:i.X=m.position().left,i.X-=(k-m.outerWidth(!0))/2,j={before:{left:-1*i.X+c.X},after:{left:-1*i.X}}}return j}};if(e[b]&&b.toLowerCase()!="init")return e[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||!b)return e.init.apply(this,arguments);a.error('Method "'+b+'" does not exist in iPhoneSlide plugin!')}})(jQuery)
