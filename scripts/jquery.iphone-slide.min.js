/**
 * iphoneSlide - jQuery plugin
 * @version: 0.5 (2011/03/14)
 * @requires jQuery v1.4+
 * @author Hina, Cain Chen. hinablue [at] gmail [dot] com
 * Examples and documentation at: http://jquery.hinablue.me/jqiphoneslide
 * 
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 **/(function(a){var b={handler:undefined,pageHandler:undefined,slideHandler:undefined,direction:"horizontal",maxShiftPage:5,nextPageHandler:".nextPage",prevPageHandler:".prevPage",draglaunch:.5,friction:.325,sensitivity:20,extrashift:800,touchduring:800,easing:"swing",pageshowfilter:!1,onShiftComplete:function(){}};a.fn.iphoneSlide=function(c,d){function j(b,c){var b=b,c=c||{X:0,Y:0},d=a(f.handler,e),g=f.pageshowfilter?d.children(f.pageHandler).filter("visible"):d.children(f.pageHandler),h={X:0,Y:0},i={before:{},after:{}},j=e.width(),k=e.height(),l=g.eq(b-1);switch(f.direction){case"matrix":h.X=l.position().left,h.X-=(j-l.outerWidth(!0))/2,h.Y=l.position().top,h.Y-=(k-l.outerHeight(!0))/2,i={before:{top:-1*h.Y+c.Y,left:-1*h.X+c.X},after:{top:-1*h.Y,left:-1*h.X}};break;case"vertical":h.Y=l.position().top,h.Y-=(k-l.outerHeight(!0))/2,i={before:{top:-1*h.Y+c.Y},after:{top:-1*h.Y}};break;case"horizontal":default:h.X=l.position().left,h.X-=(j-l.outerWidth(!0))/2,i={before:{left:-1*h.X+c.X},after:{left:-1*h.X}}}return i}function i(){var b=e.data("workData"),c=b.nowPage;f.pageshowfilter?f.onShiftComplete.call(e,a(f.handler,e).children(f.pageHandler).filter(":visible").eq(c-1),c):f.onShiftComplete.call(e,a(f.handler,e).children(f.pageHandler).eq(c-1),c)}function h(){var b,c=a(f.handler,e),g=f.pageshowfilter?c.children(f.pageHandler).filter(":visible"):c.children(f.pageHandler),h=matrixColumn=pagesOuterWidth=pagesOuterHeight=maxWidthPage=maxHeightPage=0;b=g.length,maxWidthPage=e.width(),maxHeightPage=e.height();switch(f.direction){case"matrix":h=Math.ceil(Math.sqrt(b)),matrixColumn=Math.ceil(b/h),g.each(function(b,c){maxWidthPage=a(c).outerWidth(!0)>=maxWidthPage?a(c).outerWidth(!0):maxWidthPage,maxHeightPage=a(c).outerHeight(!0)>=maxHeightPage?a(c).outerHeight(!0):maxHeightPage}),pagesOuterWidth=maxWidthPage*h,pagesOuterHeight=maxHeightPage*matrixColumn,c.width(pagesOuterWidth).height(pagesOuterHeight),g.each(function(b,c){a(c).outerWidth()<maxWidthPage&&a(c).css({"margin-left":(maxWidthPage-a(c).outerWidth())/2,"margin-right":(maxWidthPage-a(c).outerWidth())/2}),a(c).outerHeight()<maxHeightPage&&a(c).css({"margin-top":(maxHeightPage-a(c).outerHeight())/2,"margin-bottom":(maxHeightPage-a(c).outerHeight())/2})});for(var i=matrixColumn;i>1;i--)a('<br class="matrix-break-point" style="clear:both;" />').insertAfter(g.eq((i-1)*h-1));break;case"vertical":g.each(function(b,c){pagesOuterHeight+=a(c).outerHeight(!0),maxWidthPage=a(c).outerWidth(!0)>=maxWidthPage?a(c).outerWidth(!0):maxWidthPage,maxHeightPage=a(c).outerHeight(!0)>=maxHeightPage?a(c).outerHeight(!0):maxHeightPage}),g.each(function(b,c){a(c).outerWidth()<maxWidthPage&&a(c).css("margin-left",(maxWidthPage-a(c).outerWidth())/2)}),pagesOuterWidth=maxWidthPage,c.height(pagesOuterHeight).width(pagesOuterWidth).css("top",(maxHeightPage-g.eq(0).outerHeight(!0))/2);break;case"horizontal":default:g.each(function(b,c){pagesOuterWidth+=a(c).outerWidth(!0),maxWidthPage=a(c).outerWidth(!0)>=maxWidthPage?a(c).outerWidth(!0):maxWidthPage,maxHeightPage=a(c).outerHeight(!0)>=maxHeightPage?a(c).outerHeight(!0):maxHeightPage}),g.each(function(b,c){a(c).outerHeight()<maxHeightPage&&a(c).css("margin-top",(maxHeightPage-a(c).outerHeight())/2)}),pagesOuterHeight=maxHeightPage,c.width(pagesOuterWidth).height(pagesOuterHeight).css("left",(maxWidthPage-g.eq(0).outerWidth(!0))/2)}g.css({display:"block"}),e.width(maxWidthPage).height(maxHeightPage).data("workData",a.extend({},{totalPages:b,matrixRow:h,matrixColumn:matrixColumn,pagesOuterWidth:pagesOuterWidth,pagesOuterHeight:pagesOuterHeight,nowPage:1,initIphoneSlide:!0})),a.isFunction(d)&&d.call(e)}function g(a,b,c,d){var e=0,g=0,a=a*1,b=b*1,c=c*1,d=d*1;e=Math.abs(b-c)/Math.abs(d),g=Math.floor(Math.pow(e/12,2)*Math.abs(f.extrashift)/(2*(9.80665/12)*Math.abs(f.friction))*.01),g=b>a/2?Math.floor(a/3):b;return{speed:e,shift:g}}var e=a(this),f=a.extend({},b,c),d=typeof d=="function"?d:function(){return!1};return this.each(function(){var b=a(this),c=b.data("workData"),d=a(f.handler,b),e=a.extend({},{origX:0,origY:0,X:0,Y:0}),k,l,m=matrixRow=matrixColumn=0,n=1,o=__mouseStarted=__touchesDevice=!1,p=a(f.handler,b).children(f.pageHandler);f.pageshowfilter&&(p=p.filter(":visible"));if(b.children().length>1){alert("The Selector("+b.attr("id")+")'s page handler can not more than one element.");return this}if(f.handler===undefined||typeof f.handler!="string")f.handler=".iphone-slide-page-handler",b.children(":first").addClass("iphone-slide-page-handler");if(a(f.handler,b).children().length==0){alert("You have no page(s) context.");return this}if(f.pageHandler===undefined||typeof f.pageHandler!="string")switch(d.attr("tagName").toLowerCase()){case"ul":case"ol":f.pageHandler="li";break;default:f.pageHandler=d.children(":first").attr("tagName").toLowerCase()}var q=function(e){var f=parseInt(c.nowPage),g=parseInt(c.totalPages);f++;if(f<=g){__mouseStarted=!0;var h=j(f);d.animate(h.after,300,function(){__mouseStarted=!1,i(b)})}else f=g;b.data("nowPage",a.extend({},c,{nowPage:f}));return!0},r=function(e){var f=parseInt(c.nowPage),g=parseInt(c.totalPages);f--;if(f>0){__mouseStarted=!0;var h=j(f);d.animate(h.after,300,function(){__mouseStarted=!1,i(b)})}else f=1;b.data("nowPage",a.extend({},c,{nowPage:f}));return!0},s=function(b){if(__mouseStarted)return!1;b.preventDefault(),__mouseStarted=!0;var c=b.originalEvent.touches||b.originalEvent.targetTouches||b.originalEvent.changedTouches,g=c===undefined?b:c[0];k=a.extend({},g,{timeStamp:b.timeStamp}),c!==undefined&&(__touchesDevice=!0),e.origX=a(this).position().left,e.origY=a(this).position().top,f.slideHandler===undefined||typeof f.slideHandler!="string"?d.bind("mousemove touchmove",t,!1).bind("mouseleave mouseup touchend touchcancel",u,!1):d.filter(f.slideHandler).bind("mousemove touchmove",t,!1).bind("mouseleave mouseup touchend touchcancel",u,!1)},t=function(b){if(a.browser.msie&&!b.button)return u(b);if(__mouseStarted){b.preventDefault();var c=b.originalEvent.touches||b.originalEvent.targetTouches||b.originalEvent.changedTouches,g=c===undefined?b:c[0],h=k;l=a.extend({},g,{timeStamp:b.timeStamp});switch(f.direction){case"matrix":e.X=parseInt(g.pageX-h.pageX),e.Y=parseInt(g.pageY-h.pageY),d.css({top:e.origY+e.Y+"px",left:e.origX+e.X+"px"});break;case"vertical":e.Y=parseInt(g.pageY-h.pageY),d.css({top:e.origY+e.Y+"px"});break;case"horizontal":default:e.X=parseInt(g.pageX-h.pageX),d.css({left:e.origX+e.X+"px"})}}return!__mouseStarted},u=function(c){c.preventDefault(),f.slideHandler===undefined||typeof f.slideHandler!="string"?d.unbind("mousemove touchmove",t,!1):d.filter(f.slideHandler).unbind("mousemove touchmove",t,!1);var h=a(this).parent().data("workData"),m=parseInt(h.totalPages),n=parseInt(h.nowPage),q=parseInt(h.matrixRow),r=parseInt(h.matrixColumn),s,v=c.originalEvent.touches||c.originalEvent.targetTouches||c.originalEvent.changedTouches,w=k;v===undefined?s=__touchesDevice?l:c:s=v[0]===undefined?l:v[0],__mouseStarted&&(o=c.target==w.target);if(Math.max(Math.abs(w.pageX-s.pageX),Math.abs(w.pageY-s.pageY))>=parseInt(f.sensitivity)){var x=Math.abs(l.timeStamp-k.timeStamp),y=p.eq(n-1),z={width:y.outerWidth(!0),height:y.outerHeight(!0)},A={X:g(z.width,w.pageX,s.pageX,x),Y:g(z.height,w.pageY,s.pageY,x)},B={X:0,Y:0,shift:Math.max(A.X.shift,A.Y.shift),speed:Math.max(A.X.speed,A.Y.speed)},C={X:Math.min(s.pageX-w.pageX,z.width),Y:Math.min(s.pageY-w.pageY,z.height)},D={X:Math.abs(e.X)>=z.width*f.draglaunch||Math.abs(e.Y)>=z.height*f.draglaunch?0:x>f.touchduring?1:Math.ceil(A.X.speed*A.X.shift/z.width),Y:Math.abs(e.X)>=z.width*f.draglaunch||Math.abs(e.Y)>=z.height*f.draglaunch?0:x>f.touchduring?1:Math.ceil(A.Y.speed*A.Y.shift/z.height)};during=Math.min(300,f.touchduring,Math.max(1/B.speed*Math.abs(f.extrashift),Math.abs(f.extrashift)*.5));switch(f.direction){case"matrix":var E=Math.ceil(n/q);D.X=D.X>q?q:Math.abs(e.X)>=z.width*f.draglaunch?1:Math.floor(Math.abs(C.Y/C.X))>2?0:D.X,D.X=C.X>0?Math.min(D.X,n-q*(E-1)-1):Math.min(D.X,q*E-n),D.Y=D.Y>r?r:Math.abs(e.Y)>=z.height*f.draglaunch?1:Math.floor(Math.abs(C.X/C.Y))>2?0:D.Y,D.Y=C.Y>0?Math.min(D.Y,E-1):q*D.Y+n>m?r-E:D.Y,n=C.X>0?n-D.X<1?1:n-D.X:n+D.X>m?m:n+D.X,n=C.Y>0?n-D.Y*q<1?1:n-D.Y*q:D.Y*q>m?m:n+D.Y*q;break;case"vertical":D.X=0,D.Y=D.Y==0?1:D.Y>f.maxShiftPage?f.maxShiftPage:D.Y,D.Y=C.Y>0?n-D.Y<1?n-1:D.Y:n+D.Y>m?m-n:D.Y,n=C.Y>0?n-D.Y<1?1:n-D.Y:n+D.Y>m?m:n+D.Y;break;case"horizontal":default:D.Y=0,D.X=D.X==0?1:D.X>f.maxShiftPage?f.maxShiftPage:D.X,D.X=C.X>0?n-D.X<1?n-1:D.X:n+D.X>m?m-n:D.X,n=C.X>0?n-D.X<1?1:n-D.X:n+D.X>m?m:n+D.X}var F=j(n,C);a(this).animate(F.before,during).animate(F.after,during,a.easing[f.easing]!==undefined?f.easing:"swing",function(){__mouseStarted=!1,i()})}else a(this).animate({top:e.origY,left:e.origX},50,function(){__mouseStarted=!1});f.slideHandler===undefined||typeof f.slideHandler!="string"?a(this).unbind("mouseleave mouseup touchend",u,!1):a(this).filter(f.slideHandler).unbind("mouseleave mouseup touchend",u,!1),b.data("workData",a.extend({},h,{nowPage:n}));return!__mouseStarted};f.slideHandler===undefined||typeof f.slideHandler!="string"?d.bind("mousedown touchstart",s,!1).bind("click",function(a){if(o){o=!1,a.stopImmediatePropagation();return!1}},!1):d.filter(f.slideHandler).bind("mousedown touchstart",s,!1).bind("click",function(a){if(o){o=!1,a.stopImmediatePropagation();return!1}},!1),h();return this})},a.fn.slidingToPage=function(b){var c=a(this).data("workData");if(!c.initIphoneSlide){alert("Your target is not iPhone-Slide workspace.");return!1}}})(jQuery)